# EPDO(사고피해정도지수)_동별 지도 작성_README

## # 기초환경설치
### package설치 (dplyr, writexl, readxl, ggmap)

```c 
install.packages("dplyr")

install.packages("writexl")

install.packages("readxl")

install.packages("ggmap")
```	

### library 불러오기
```c 
library(dplyr)

library(writexl)

library(readxl)

library(ggmap)
```
---------------------------------------------
---------------------------------------------
---------------------------------------------

## # 대전광역시 사망사고건수

### 원본 데이터 불러오기
+ 코드를 실행하여 첨부한 원본데이터 (가해자차종 또는 피해자차종이 이륜차인 교통사고 정보(2015~2019년).csv)를 불러오기
```c 
data <- read.csv(file.choose())
```

### 필요한 변수 선택
+ filter()를 통해 원본 데이터(data)에서 사용할 변수들만 뽑아오기
```c 
data1<-filter(data,가해자신체상해정도=="사망"&발생지_시도=="대전")
```

### 동별 사망사고건수 데이터 생성
+ group_by()와 summarise()를 통해 동별로 사고건수를 뽑아 data2에 저장
```c 
data2<-group_by(data1,법정동명) %>% summarise(n=n())
```

### 뽑힌 데이터 개수 확인
+ View()를 통해 data2의 행(동 이름) 개수를 확인
```c 
View(data2)
```

---------------------------------------------
---------------------------------------------
---------------------------------------------

## #대전광역시 부상사고건수

### 원본 데이터 불러오기
+ 코드를 실행하여 첨부한 원본데이터 (가해자차종 또는 피해자차종이 이륜차인 교통사고 정보(2015~2019년).csv)를 불러오기
```c
data3 <- read.csv(file.choose()) 
```

### 필요한 변수 선택
+ filter함수를 통해 원본데이터(data3)에서 사용할 변수들만 뽑아오기
```c
data4 <- filter(data3,가해자신체상해정도=="중상"|가해자신체상해정도=="경상"|가해자신체상해정도=="부상신고")
data5 <- filter(data4,발생지_시도=="대전")
```

### 동별 부상사고건수 데이터 생성
+ group_by()와 summarise()를 통해 동별로 사고건수를 뽑아 data6에 저장
```c
data6<-group_by(data5,법정동명) %>% summarise(n=n())
```

### 뽑힌 데이터 개수 확인
+ View()를 통해 data6의 행(동 이름) 개수를 확인
```c
View(data6)
```

---------------------------------------------
---------------------------------------------
---------------------------------------------

## # EPDO 구하기 & 위치정보

### 사망사고건수와 부상사고건수 데이터 병합
+ rbind()를 통해 사망사고건수(data2)와 부상사고건수(data6) 합치기
```c
Dong <- rbind(data2,data6)
```

## # EPDO 구하기 전 !
+ 물피사고는 위의 원본 데이터에서 정확히 파악할 수 없는 부분이기 때문에 제외하고 EPDO를 구합니다.
+ 위의 원본 데이터로 사고건수만을 생각한다면, 2015~2019년 대전지역에서 사망과 부상사고 모두 일어난 적이 있는 경우는 약 20여개의 동네입니다.
+ 또한, 절반 이상의 동네가 사망사고건이 없는 곳은 부상이 없고, 부상사고건이 있는 곳은 사망이 없는 경우입니다.

+ 따라서, 사망사고건이 있는 곳은 부상사고건수를 0으로 , 부상사고건이 있는 곳은 사망사고건수를 0으로 설정하여 계산합니다.

### EPDO 구하기
엑셀에서 PRODUCT 함수를 통해 count의 1번째부터 24번째(사망사고 발생한 동네)값까지 (셀 이름,12)로 사망사고건수의 EPDO를 구합니다.
엑셀에서 PRODUCT 함수를 통해 count의 25번째부터 마지막(부상사고 발생한 동네)값까지 (셀 이름,3)로 부상사고건수의 EPDO를 구합니다.

### 동별로 지도에 점을 찍기 위해 구글링을 통해 구 이름과 위치정보(위도,경도)를 엑셀 데이터에 입력합니다.



## # EPDO 동별 지도 작성

### 원본 데이터 불러오기
	Dong <- read_excel(file.choose()) 코드를 실행하여 생성한 엑셀 데이터(동별사고score.xlsx)를 불러옵니다.
 
### 점찍을 지도 위치 지정
	boxLocation에 벡터의 값으로 대전광역시가 중심이 되는 지도가 나타날 수 있는 경도,위도를 설정합니다.(구글 맵 참고)

### 구글 맵 인증key 등록 
	지도의 정확도를 더 높이기 위해서 개인 계정 로그인으로 구글 맵에서 받은 인증key를 복사해 등록합니다. 

### 대전광역시의 구글 지도 작성
	get_map함수를 통해 설정한 boxLocation의 위치에 지도 타입과 출처를 작성하고, 대전광역시가 충분히 보이도록 확대합니다.


### EPDO 동별 지도 작성  ###
	get_map함수를 통해 설정한 지도(KrMap)를 ggmap함수에 적용시킵니다.
	geom_point함수를 통해 x축과 y축을 설정하고 점 색상으로 시군구를, 점 크기로 EPDO를 구분합니다. 
	지도 구성요소들의 디자인을 변경하는 theme함수를 통해 범례 위치를 지도 안 쪽으로 위치시킵니다. 

